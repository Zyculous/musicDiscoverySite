import{_ as T,o as c,c as d,a as o,w as k,v as C,b,d as f,F as u,r as y,e as w,t as p,f as v,n as B,g as S,h as R,i as U,j as A}from"./index-CvUhUh0g.js";const $="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA60lEQVR4nO3ZSxLBUBCF4WZgT1if17ZirsxYgNjGryIXKRWPIKr71vmGrUrdowe5R8wkA8AIWAFHbkpgUX1mUQBLHptbFNS/fmXcmE0um7EoSN6du4XXIMAA2NJRy/dc5/zH+v4AQ2ATMEjx7QZfBgmBjIKU6cyTxmyaZgeLgvoJ/sjMgl1RFo3NnDdRhQh1RRER6UQFzRsVtOwvn3xYrH7lWRD+UawcBCnMg3eChJBTkDKdWQXNBRU0EemPSpA36C2VM0S44FH/l7vvuTv0Yd0WZBcwSPHJ1l4GCYGMgpTpzCpBLqC3VGJdnADCA46YPgQ6pgAAAABJRU5ErkJggg==",j="45d6d0678f9c4d9cbce9c7e1bbb2bc8f",F={data(){return{searchValue:"",searchTypes:["album","artist","track"],searchResults:{},dropdownOpen:!1,collapsedTypes:{}}},methods:{toggleCollapse(t){this.collapsedTypes[t]=!this.collapsedTypes[t]},async search(t,e,r){if(t.key==="Enter"){e=e.join("%2C"),console.log(e);try{const g=localStorage.getItem("access_token"),n=await(await fetch(`https://api.spotify.com/v1/search?q=${r}&type=${e}`,{headers:{Authorization:`Bearer ${g}`}})).json();console.log(n),this.searchResults=n,n.error.status==401&&(console.log("Refreshing token..."),this.refreshToken())}catch(g){console.error("Search error:",g)}}},toggleDropdown(){this.dropdownOpen=!this.dropdownOpen},async refreshToken(){const t=localStorage.getItem("refresh_token"),e=" https://accounts.spotify.com/api/token",r={method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({grant_type:"refresh_token",refresh_token:t,client_id:j})},l=await(await fetch(e,r)).json();localStorage.setItem("access_token",l.access_token),localStorage.setItem("refresh_token",l.refresh_token);const n=localStorage.getItem("refresh_token");console.log(n);try{const s=await fetch("http://localhost:5000/spotifyLogin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:localStorage.getItem("userEmail"),code:n})}),i=await s.json();s.ok?console.log("Code Storage Successful:",i):console.error("Storage Failed:",i)}catch(s){console.error("Storage Failed:",s)}},onDrop(t,e){const r=JSON.parse(t.dataTransfer.getData("tag"));console.log("Dropped tag:",r,"on target:",e)}}},J={style:{position:"relative",display:"inline-block",width:"100%"}},K={key:0,class:"dropdown-content"},M={class:"filter-options"},z={class:"filter-options"},X={class:"filter-options"},Y=["onClick"],Q={key:0,class:"listedArtists"},W=["onDrop"],G=["href"],H=["src","alt"],Z={key:1,class:"listedAlbums"},q=["onDrop"],ee=["href"],te=["href"],se=["src","alt"],oe={key:2,class:"listedSongs"},ae=["onDrop"],re=["src","alt"],ne={class:"result-details"},le={class:"result-bb"},ie=["href"],ce={class:"result-bb"},de={"style:":{display:"flex",flexDirection:"row"}},ge=["href"],he={key:0,class:"result-title"},pe={class:"result-bb"},ue=["href"];function ye(t,e,r,g,l,n){return c(),d("div",null,[o("div",null,[o("div",J,[k(o("input",{class:"search-bar",type:"text",placeholder:"Search songs","onUpdate:modelValue":e[0]||(e[0]=s=>l.searchValue=s),onKeypress:e[1]||(e[1]=s=>n.search(s,l.searchTypes,l.searchValue)),style:{width:"calc(100% - 40px)"}},null,544),[[C,l.searchValue]]),o("button",{class:"filter-btn",onClick:e[2]||(e[2]=(...s)=>n.toggleDropdown&&n.toggleDropdown(...s)),style:{position:"absolute",right:0,top:"0",height:"100%",width:"40px",backgroundColor:"#232323"}},e[9]||(e[9]=[o("img",{src:$,alt:"Filter",style:{height:"100%",width:"100%"}},null,-1)]))]),l.dropdownOpen?(c(),d("div",K,[o("div",M,[k(o("input",{type:"checkbox",id:"album",name:"album",value:"album","onUpdate:modelValue":e[3]||(e[3]=s=>l.searchTypes=s)},null,512),[[b,l.searchTypes]]),e[10]||(e[10]=o("label",{for:"album"},"Album",-1))]),o("div",z,[k(o("input",{type:"checkbox",id:"artist",name:"artist",value:"artist","onUpdate:modelValue":e[4]||(e[4]=s=>l.searchTypes=s)},null,512),[[b,l.searchTypes]]),e[11]||(e[11]=o("label",{for:"artist"},"Artist",-1))]),o("div",X,[k(o("input",{type:"checkbox",id:"track",name:"track",value:"track","onUpdate:modelValue":e[5]||(e[5]=s=>l.searchTypes=s)},null,512),[[b,l.searchTypes]]),e[12]||(e[12]=o("label",{for:"track"},"Song",-1))])])):f("",!0)]),o("div",null,[(c(!0),d(u,null,y(l.searchResults,(s,i)=>(c(),d("div",{key:i},[o("h2",{onClick:a=>n.toggleCollapse(i)},[w(p(i)+" ",1),o("span",null,p(l.collapsedTypes[i]?"➤":"▼"),1)],8,Y),!l.collapsedTypes[i]&&i=="artists"?(c(),d("div",Q,[(c(!0),d(u,null,y(s.items,a=>{var h;return c(),d("div",{key:a.id,class:"search-result-artist",onDragover:e[6]||(e[6]=v(()=>{},["prevent"])),onDrop:_=>n.onDrop(_,a)},[o("a",{class:"result-title",href:a.external_urls.spotify,style:{color:"#ffffff"}},p(a.name),9,G),o("img",{src:(h=a.images[0])==null?void 0:h.url,alt:a.name,style:{width:"100%",padding:"10px 0px 0px 0px"}},null,8,H)],40,W)}),128))])):f("",!0),!l.collapsedTypes[i]&&i=="albums"?(c(),d("div",Z,[(c(!0),d(u,null,y(s.items,a=>(c(),d("div",{key:a.id,class:"search-result-album",onDragover:e[7]||(e[7]=v(()=>{},["prevent"])),onDrop:h=>n.onDrop(h,a)},[o("a",{class:"result-title",href:a.external_urls.spotify},p(a.name),9,ee),(c(!0),d(u,null,y(a.artists,h=>(c(),d("a",{class:"result-artists",key:h.id,href:h.external_urls.spotify},p(h.name),9,te))),128)),o("img",{src:a.images[0].url,alt:a.name,style:{width:"100%"}},null,8,se)],40,q))),128))])):f("",!0),!l.collapsedTypes[i]&&i=="tracks"?(c(),d("div",oe,[(c(!0),d(u,null,y(s.items,a=>(c(),d("div",{key:a.id,class:"search-result-song",onDragover:e[8]||(e[8]=v(()=>{},["prevent"])),onDrop:h=>n.onDrop(h,a)},[o("img",{class:"result-image",src:a.album.images[0].url,alt:a.name},null,8,re),o("div",ne,[o("div",le,[e[13]||(e[13]=o("h3",null,"Track",-1)),o("a",{class:"result-title",href:a.external_urls.spotify},p(a.name),9,ie)]),o("div",ce,[e[14]||(e[14]=o("h4",null,"Artists",-1)),o("div",de,[(c(!0),d(u,null,y(a.artists,(h,_)=>(c(),d("a",{class:"result-title",key:h.id,href:h.external_urls.spotify},[_>0?(c(),d("span",he,"& ")):f("",!0),w(" "+p(h.name),1)],8,ge))),128))])]),o("div",pe,[e[15]||(e[15]=o("h3",null,"Album",-1)),o("a",{class:"result-title",href:a.album.external_urls.spotify},p(a.album.name),9,ue)])])],40,ae))),128))])):f("",!0)]))),128))])])}const me=T(F,[["render",ye],["__scopeId","data-v-81d037de"]]),fe="45d6d0678f9c4d9cbce9c7e1bbb2bc8f",ke={data(){return{playlists:[],playlistsLoaded:!1,expandedPlaylists:[],tagColor:"#1DB954"}},async mounted(){const t=this.getCachedPlaylists();t&&t.length>0?(this.playlists=t,this.playlistsLoaded=!0,console.log("Loaded playlists from sessionStorage:",this.playlists)):(console.log("No cached playlists found or cache is empty, fetching playlists..."),this.refreshToken(),this.fetchPlaylists())},methods:{getCachedPlaylists(){try{const t=sessionStorage.getItem("playlists");if(t)return JSON.parse(t)}catch(t){console.error("Error getting cached playlists from sessionStorage:",t)}return null},async fetchPlaylists(){try{const t=localStorage.getItem("access_token"),r=await(await fetch("https://api.spotify.com/v1/me/playlists",{headers:{Authorization:`Bearer ${t}`}})).json();r.items?(this.playlists=r.items.map(g=>({id:g.id,name:g.name,tracksLoaded:!1,images:g.images,tracks:g.tracks})),this.playlistsLoaded=!0,sessionStorage.setItem("playlists",JSON.stringify(this.playlists)),console.log("Fetched playlists from Spotify:",this.playlists),this.playlists.forEach(g=>this.fetchPlaylistTracks(g.id))):console.error("Error fetching playlists: No items found")}catch(t){console.error("Error fetching playlists:",t)}},togglePlaylist(t){const e=this.playlists.find(r=>r.id===t);if(!e){console.error("Playlist not found:",t);return}this.expandedPlaylists.includes(t)?this.expandedPlaylists=this.expandedPlaylists.filter(r=>r!==t):(this.expandedPlaylists.push(t),e.tracksLoaded||this.fetchPlaylistTracks(t)),console.log("Toggled playlist:",t,this.expandedPlaylists)},async fetchPlaylistTracks(t){try{const e=localStorage.getItem("access_token");let r=0;const g=50;let l=[],n=0;do{const a=await(await fetch(`https://api.spotify.com/v1/playlists/${t}/tracks?offset=${r}&limit=${g}`,{headers:{Authorization:`Bearer ${e}`}})).json();if(a.items)l=l.concat(a.items),r+=g,n=a.total;else{console.error("Error fetching playlist tracks: No items found");break}}while(r<n);const s=this.playlists.find(i=>i.id===t);s?(s.tracks.items=l.map(i=>({...i,tags:[],parent:`${t}`})),s.tracksLoaded=!0,console.log("Fetched tracks for playlist from Spotify:",t,s.tracks.items),sessionStorage.setItem("playlists",JSON.stringify(this.playlists))):console.error("Playlist not found when fetching tracks:",t)}catch(e){console.error("Error fetching playlist tracks:",e)}},onDrop(t,e){var i;const r=JSON.parse(t.dataTransfer.getData("tag"));console.log("Dropped tag:",r,"on target:",e);const g=document.createElement("div");g.classList.add("tag-pill"),g.textContent=r.name,g.style.backgroundColor=this.tagColor;let l=document.getElementById(e.track.id).querySelector(".tags-container");l||(l=t.target.querySelector(".tags-container"));let n=this.playlists.find(a=>a.id===e.parent);console.log(n);let s=(i=n.tracks)==null?void 0:i.items.find(a=>a.id===e.track.id);console.log("Track:",s),s&&(s.tags?s.tags.push({id:Date.now(),name:r.name,color:this.tagColor}):s.tags=[{id:Date.now(),name:r.name,color:this.tagColor}]),console.log("Tags container:",l)},async refreshToken(){const t=localStorage.getItem("refresh_token"),e=" https://accounts.spotify.com/api/token",r={method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({grant_type:"refresh_token",refresh_token:t,client_id:fe})},l=await(await fetch(e,r)).json();localStorage.setItem("access_token",l.access_token),localStorage.setItem("refresh_token",l.refresh_token);const n=localStorage.getItem("refresh_token");console.log(n);try{const s=await fetch("http://localhost:5000/spotifyLogin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:localStorage.getItem("userEmail"),code:n})}),i=await s.json();s.ok?console.log("Code Storage Successful:",i):console.error("Storage Failed:",i)}catch(s){console.error("Storage Failed:",s)}},changeTagColor(t){this.tagColor=t.target.value}}},_e={class:"playlists-view"},ve={key:0,class:"loading"},Ce={key:1},we=["onClick"],Te=["src","alt"],be={key:0,class:"songs"},Se={key:0,class:"loading-songs"},Ae={key:1},Pe=["id","data-track-id","onDrop"],De={class:"track-number"},xe=["src","alt"],Le={class:"song-details"},Ie=["href"],Ee={class:"song-artists"},Ve=["onDrop"],Oe=["href"],Re={class:"tags-container"};function Be(t,e,r,g,l,n){return c(),d("div",_e,[e[2]||(e[2]=o("h1",null,"Your Playlists",-1)),l.playlistsLoaded?(c(),d("div",Ce,[(c(!0),d(u,null,y(l.playlists,s=>{var i;return c(),d("div",{key:s.id,class:"playlist"},[o("h2",{onClick:a=>n.togglePlaylist(s.id)},[o("img",{src:(i=s==null?void 0:s.images[0])==null?void 0:i.url,alt:s.name,class:"playlist-image"},null,8,Te),w(" "+p(s.name),1)],8,we),l.expandedPlaylists.includes(s.id)?(c(),d("div",be,[s.tracksLoaded?(c(),d("div",Ae,[(c(!0),d(u,null,y(s.tracks.items,(a,h)=>{var _,P,D,x,L,I,E,V,O;return c(),d("div",{id:(_=a.track)==null?void 0:_.id,key:(P=a.track)==null?void 0:P.id,class:"song","data-track-id":(D=a.track)==null?void 0:D.id,onDragover:e[1]||(e[1]=v(()=>{},["prevent"])),onDrop:m=>n.onDrop(m,a)},[o("div",De,p(h+1),1),o("img",{src:(L=(x=a.track)==null?void 0:x.album.images[0])==null?void 0:L.url,alt:(I=a.track)==null?void 0:I.name,class:"song-image"},null,8,xe),o("div",Le,[o("a",{href:(E=a.track)==null?void 0:E.external_urls.spotify,class:"song-title"},p((V=a.track)==null?void 0:V.name),9,Ie),o("div",Ee,[(c(!0),d(u,null,y((O=a.track)==null?void 0:O.artists,m=>(c(),d("span",{key:m.id,class:"song-artist",onDragover:e[0]||(e[0]=v(()=>{},["prevent"])),onDrop:N=>n.onDrop(N,m)},[o("a",{href:m.external_urls.spotify},p(m.name),9,Oe)],40,Ve))),128))])]),o("div",Re,[(c(!0),d(u,null,y(a.tags,m=>(c(),d("div",{key:m.id,class:"tag-pill",style:B({backgroundColor:m.color})},p(m.name),5))),128))])],40,Pe)}),128))])):(c(),d("div",Se,[(c(),d(u,null,y(10,a=>o("div",{key:a,class:"skeleton-song"})),64))]))])):f("",!0)])}),128))])):(c(),d("div",ve,"Loading..."))])}const $e=T(ke,[["render",Be],["__scopeId","data-v-32b4fa8c"]]),Ne={props:{categories:Array,categoriesLoaded:Boolean},data(){return{newCategory:"",tagColor:"#1DB954"}},methods:{toggleCategory(t){const e=this.categories.find(r=>r.id===t);e&&(e.open=!e.open)},removeCategory(t){this.$emit("remove-category",t)},addTag(t){const e=this.categories.find(r=>r.id===t);e&&e.newTag.trim()&&(e.tags.push({id:Date.now(),name:e.newTag,color:this.tagColor}),e.newTag="")},removeTag(t,e){const r=this.categories.find(g=>g.id===t);r&&(r.tags=r.tags.filter(g=>g.id!==e))},handleKeyPress(t,e){t.key==="Enter"&&this.addTag(e)},handleCategoryKeyPress(t){t.key==="Enter"&&this.addCategory()},addCategory(){this.newCategory.trim()&&(this.$emit("add-category",this.newCategory),this.newCategory="")},changeTagColor(t){this.tagColor=t.target.value},onDragStart(t,e){t.dataTransfer.setData("tag",JSON.stringify(e)),t.dataTransfer.effectAllowed="move";const r=document.createElement("div");r.classList.add("drag-image"),r.textContent=e.name,document.body.appendChild(r),t.dataTransfer.setDragImage(r,0,0),t.dragImage=r,t.target.addEventListener("dragend",()=>{document.body.contains(r)&&document.body.removeChild(r)})},onDrag(t){const e=t.target.dragImage;e&&(e.style.left=`${t.pageX}px`,e.style.top=`${t.pageY}px`)}}},Ue={class:"category-listing"},je={key:0},Fe={key:1},Je={class:"category-header"},Ke=["onClick"],Me=["onClick"],ze={key:0,class:"tags"},Xe=["onDragstart"],Ye=["onClick"],Qe={class:"add-tag"},We=["onUpdate:modelValue","onKeypress"],Ge=["onClick"],He={class:"add-category"};function Ze(t,e,r,g,l,n){return c(),d("div",Ue,[r.categoriesLoaded?(c(),d("div",Fe,[(c(!0),d(u,null,y(r.categories,s=>(c(),d("div",{class:"category",key:s.id},[o("div",Je,[o("div",{onClick:i=>n.toggleCategory(s.id),class:"category-title"},p(s.name),9,Ke),o("button",{class:"remove-category-btn",onClick:i=>n.removeCategory(s.id)},"✖",8,Me)]),s.open?(c(),d("div",ze,[(c(!0),d(u,null,y(s.tags,i=>(c(),d("div",{key:i.id,class:"tag",draggable:"true",onDragstart:a=>n.onDragStart(a,i),onDrag:e[0]||(e[0]=a=>n.onDrag(a))},[w(p(i.name)+" ",1),o("button",{class:"remove-tag-btn",onClick:a=>n.removeTag(s.id,i.id)},"✖",8,Ye)],40,Xe))),128)),o("div",Qe,[k(o("input",{class:"add-tag-input","onUpdate:modelValue":i=>s.newTag=i,placeholder:"Add a tag",onKeypress:i=>n.handleKeyPress(i,s.id)},null,40,We),[[C,s.newTag]]),k(o("input",{type:"color","onUpdate:modelValue":e[1]||(e[1]=i=>l.tagColor=i),onInput:e[2]||(e[2]=(...i)=>n.changeTagColor&&n.changeTagColor(...i))},null,544),[[C,l.tagColor]]),o("button",{onClick:i=>n.addTag(s.id),class:"add-tag-btn"},"✔",8,Ge)])])):f("",!0)]))),128)),o("div",He,[k(o("input",{class:"add-category-input","onUpdate:modelValue":e[3]||(e[3]=s=>l.newCategory=s),placeholder:"Add a category",onKeypress:e[4]||(e[4]=s=>n.handleCategoryKeyPress(s))},null,544),[[C,l.newCategory]]),o("button",{onClick:e[5]||(e[5]=(...s)=>n.addCategory&&n.addCategory(...s)),class:"add-category-btn"},"✔")])])):(c(),d("div",je,[(c(),d(u,null,y(30,s=>o("div",{key:s,class:"skeleton-content-2",style:B({marginLeft:`${Math.random()*20}%`,width:`${100-Math.random()*20}%`})},null,4)),64))]))])}const qe=T(Ne,[["render",Ze],["__scopeId","data-v-79fb7331"]]),et="45d6d0678f9c4d9cbce9c7e1bbb2bc8f",tt={components:{SearchView:me,PlaylistsView:$e,CategoryListing:qe},name:"OrganizeView",data(){return{categories:[],categoriesLoaded:!1,newCategory:"",newTag:"",dropdownOpen:!1,searchValue:"",searchTypes:["album","artist","track"],searchLoaded:!1,searchResults:{},filter:$,collapsedTypes:{},currentPage:"Search"}},mounted(){setTimeout(()=>{this.categories=[{id:1,name:"Category 1",open:!1,tags:[{id:Math.random()+1,name:"tag1"}],newTag:""},{id:2,name:"Category 2",open:!1,tags:[],newTag:""}],this.categoriesLoaded=!0},2e3)},methods:{toggleCategory(t){const e=this.categories.find(r=>r.id===t);e.open=!e.open},handleKeyPress(t,e){t.key==="Enter"&&this.addTag(e)},handleCategoryKeyPress(t){t.key==="Enter"&&this.addCategory()},async refreshToken(){const t=localStorage.getItem("refresh_token"),e=" https://accounts.spotify.com/api/token",r={method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({grant_type:"refresh_token",refresh_token:t,client_id:et})},l=await(await fetch(e,r)).json();localStorage.setItem("access_token",l.access_token),localStorage.setItem("refresh_token",l.refresh_token);const n=localStorage.getItem("refresh_token");console.log(n);try{const s=await fetch("http://localhost:5000/spotifyLogin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:localStorage.getItem("userEmail"),code:n})}),i=await s.json();s.ok?(console.log("Code Storage Successful:",i),this.$router.push("/account")):console.error("Storage Failed:",i)}catch(s){console.error("Storage Failed:",s)}},toggleDropdown(){this.dropdownOpen=!this.dropdownOpen},async search(t,e,r){if(t.key==="Enter"){e=e.join("%2C"),console.log(e);try{const g=localStorage.getItem("access_token"),n=await(await fetch(`https://api.spotify.com/v1/search?q=${r}&type=${e}`,{headers:{Authorization:`Bearer ${g}`}})).json();console.log(n),this.searchResults=n,this.searchLoaded=!0}catch(g){console.error("Search error:",g)}}},toggleCollapse(t){this.collapsedTypes[t]=!this.collapsedTypes[t]},navTo(t){this.currentPage=t},removeCategory(t){this.categories=this.categories.filter(e=>e.id!==t)},addCategory(t){if(!t.trim())return;const e=Math.max(...this.categories.map(r=>r.id),0)+1;this.categories.push({id:e,name:t,tags:[],open:!1,newTag:""})}}},st={class:"full-page"},ot={class:"organize-view"},at={class:"nav-bar"};function rt(t,e,r,g,l,n){const s=A("SearchView"),i=A("PlaylistsView"),a=A("CategoryListing");return c(),d("div",st,[o("div",ot,[o("div",null,[o("div",at,[o("button",{class:S(["nav-bar-option",{currentPage:l.currentPage==="Search"}]),onClick:e[0]||(e[0]=h=>n.navTo("Search"))},"Search",2),o("button",{class:S(["nav-bar-option",{currentPage:l.currentPage==="Playlists"}]),onClick:e[1]||(e[1]=h=>n.navTo("Playlists"))},"Playlists",2),o("button",{class:S(["nav-bar-option",{currentPage:l.currentPage==="Sorted"}]),onClick:e[2]||(e[2]=h=>n.navTo("Sorted"))},"Sorted",2)]),l.currentPage==="Search"?(c(),R(s,{key:0})):f("",!0),l.currentPage==="Playlists"?(c(),R(i,{key:1})):f("",!0)]),U(a,{categories:l.categories,categoriesLoaded:l.categoriesLoaded,onToggleCategory:n.toggleCategory,onRemoveCategory:n.removeCategory,onAddTag:t.addTag,onRemoveTag:t.removeTag,onAddCategory:n.addCategory,onDragStart:t.onDragStart},null,8,["categories","categoriesLoaded","onToggleCategory","onRemoveCategory","onAddTag","onRemoveTag","onAddCategory","onDragStart"])])])}const lt=T(tt,[["render",rt],["__scopeId","data-v-d5b4d836"]]);export{lt as default};
